# amazon_ml_challenge-2025-
# Smart Product Pricing Challenge - Team "Locked In"

**Team Members:** Sharish SK, Jeevan Sarasram SS, Sachin Ramesh, Sree Santh KB  
**Final Validation Score (SMAPE):** 36.18%

This repository contains the complete machine learning pipeline for the Smart Product Pricing Challenge. Our final solution is a sophisticated, two-level stacking ensemble that combines advanced text and image features to achieve a highly accurate price prediction.

## Final Model Methodology
Our best-performing model is a **Stacking Ensemble with a Non-Linear Meta-Model**.

* **Level 0 (Base Models):** We created a "team of experts" by training three powerful, GPU-accelerated models on the full feature set:
    1.  **LightGBM (Tuned):** A LightGBM model tuned using Optuna.
    2.  **XGBoost:** An XGBoost model with default settings.
    3.  **CatBoost:** A CatBoost model with default settings.

* **Level 1 (Meta-Model):** The final prediction is generated by a "smarter manager" model. This is a separate LightGBM regressor that takes the predictions from all three base models as its input. Crucially, it also receives key original features (`ipq`, `text_length`) to give it more context, allowing it to make a more intelligent final decision.

* **Features:** The models are trained on a rich, multimodal feature set:
    * **Text Features:** 384-dimension contextual embeddings generated by a pre-trained `sentence-transformers` model (`all-MiniLM-L6-v2`).
    * **Image Features:** 2048-dimension visual embeddings generated by a pre-trained `ResNet50` model.
    * **Dense Features:** `ipq` (Item Pack Quantity) and `text_length`.

---
## Setup and Installation
This project requires a specific Conda environment to handle the complex GPU dependencies for both TensorFlow and LightGBM.

1.  **Install Miniconda:** Download and install Miniconda from the official website.
2.  **Open Anaconda Prompt:** Open the **Anaconda Prompt** (not the regular command prompt).
3.  **Create Environment:** Create a new environment with Python 3.10.
    ```bash
    conda create -n tf210_gpu python=3.10
    ```
4.  **Activate Environment:**
    ```bash
    conda activate tf210_gpu
    ```
5.  **Install NVIDIA Libraries:** Install the specific CUDA and cuDNN versions.
    ```bash
    conda install -c conda-forge cudatoolkit=11.2 cudnn=8.1.0
    ```
6.  **Install Python Packages:** Install all required libraries using `pip`.
    ```bash
    python -m pip install "tensorflow<2.11"
    pip install pandas "numpy<2.0" "scipy<1.12" scikit-learn lightgbm xgboost catboost sentence-transformers transformers sentencepiece tqdm pillow optuna
    ```

---

## How to Run (To Reproduce the 36.18% Score)

All commands must be run from the **Anaconda Prompt** with the `tf210_gpu` environment active.
# 1. Activate the environment
conda activate tf210_gpu

# 2. Navigate to the project directory
cd D:\amazonML

# 3. (RUN ONCE) Generate all text embeddings for train/test
# This will use the GPU and create text_embeddings.pkl
python 00_DATA_FEATURES/create_text_embeddings.py

# 4. (RUN ONCE) Download all images
# This will download all images into the images/ and test_images/ folders
python 02_ENSEMBLE_SIMPLE/train_ensemble.py 
# (You can stop this script after the download part, or let it run)
python 03_STACKING_OVERFIT/generate_submission_stacking_v2.py 
# (This script also has the download function)

# 5. (RUN ONCE) Generate all image features
# This will use the GPU and create image_features_FULL.pkl
python 00_DATA_FEATURES/extract_image_features.py

# 6. Train the "Team of Experts" (Base Models)
# This will create lgbm_model.pkl, xgb_model.pkl, and cat_model.pkl
python 02_ENSEMBLE_SIMPLE/train_ensemble.py

# 7. Train the "Smarter Manager" (Meta-Model)
# This will create meta_model_v2.pkl
python 03_STACKING_OVERFIT/train_stacking_v2.py

# 8. Generate the Final Submission File
# This will create test_out_stacking_v2.csv
python 03_STACKING_OVERFIT/generate_submission_stacking_v2.py
